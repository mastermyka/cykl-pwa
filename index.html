<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Twój Cykl - Asystent Kobiecy Rozbudowany</title>
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
  body { font-family: 'Helvetica Neue', Arial, sans-serif; margin:0; background:#fafafa; color:#333; transition: background 0.3s, color 0.3s; }
  header { background: linear-gradient(90deg,#ff7a7a,#ff5e62); color:white; padding:1.5rem; text-align:center; }
  h1 { margin:0; font-size:1.6rem; }
  .container { padding:1rem; max-width:600px; margin:auto; }
  .card { background:white; border-radius:16px; box-shadow:0 2px 8px rgba(0,0,0,0.1); padding:1rem; margin-bottom:1rem; }
  .phase { padding:1rem; border-radius:12px; color:white; font-weight:bold; text-align:center; transition: background 0.3s; }
  .menstruacja { background:#ff4d6d; }
  .folikularna { background:#6fcf97; }
  .owulacja { background:#56ccf2; }
  .lutealna { background:#bb6bd9; }
  label { display:block; margin-top:0.5rem; font-weight:bold; }
  input { padding:0.5rem; width:100%; margin-top:0.25rem; border-radius:8px; border:1px solid #ddd; }
  button { padding:0.7rem 1.2rem; margin-top:1rem; background:#ff6f61; color:white; border:none; border-radius:10px; cursor:pointer; width:100%; font-weight:bold; }
  button:hover { background:#ff8a80; }
  table { width:100%; border-collapse:collapse; margin-top:0.5rem; }
  th, td { padding:0.5rem; border:1px solid #ddd; text-align:center; }
  th { background:#f0f0f0; }
  .calendar { display:grid; grid-template-columns: repeat(7, 1fr); gap:4px; margin-top:1rem; }
  .day { padding:8px; border-radius:8px; text-align:center; font-size:0.85rem; transition: background 0.3s; cursor:pointer; }
  .menstruacja-day { background:#ff4d6d; color:white; }
  .folikularna-day { background:#6fcf97; color:white; }
  .owulacja-day { background:#56ccf2; color:white; }
  .lutealna-day { background:#bb6bd9; color:white; }

  /* Cytat i Porada dnia */
  .daily-card { background: linear-gradient(135deg,#ff9a9e,#fad0c4); color:#fff; text-align:center; padding:2rem; font-size:1.1rem; line-height:1.5; margin-bottom:1rem; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
  .daily-card p { margin:0.5rem 0; }
  .daily-card .quote { font-style:italic; font-size:1.2rem; }
  .daily-card .tip { font-weight:bold; font-size:1.1rem; }

  /* Akordeony jedzenie i wellness */
  .accordion-btn { width: 100%; text-align: left; padding: 0.5rem 1rem; font-weight: bold;
                   background:#f0f0f0; border:none; border-radius:8px; margin-top:0.5rem; cursor:pointer; }
  .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; margin: 0.25rem 0 0 0; padding-left:1rem; list-style-type: disc; }
  .accordion-content.active { max-height: 500px; }

  /* Modal na dzień */
  #dayModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; justify-content:center; align-items:center; }
  #dayModal .modal-content { background:white; border-radius:16px; max-width:500px; width:90%; padding:1rem; position:relative; max-height:80vh; overflow-y:auto; }
  #closeModal { position:absolute; top:10px; right:10px; background:#ff6f61; color:white; border:none; border-radius:50%; width:30px; height:30px; cursor:pointer; }
/* Akordeony jedzenie i wellness */
.accordion-btn {
  width: 100%;
  text-align: left;
  padding: 0.5rem 1rem;
  font-weight: bold;
  background: linear-gradient(90deg, #ff7a7a, #ff5e62); /* zamiast #f0f0f0 */
  color: white; /* aby tekst był widoczny */
  border: none;
  border-radius: 8px;
  margin-top: 0.5rem;
  cursor: pointer;
}

.accordion-btn:hover {
  background: linear-gradient(90deg, #ff8a80, #ff6f61);
}

</style>
</head>
<body>
<header>
<h1>Twój Cykl - Asystent Kobiecy Rozbudowany</h1>
</header>
<div class="container">

<!-- Cytat dnia i Porada dnia -->
<div class="card daily-card">
  <p class="quote" id="dailyQuote"></p>
  <p class="tip" id="dailyTip"></p>
</div>

<!-- Aktualna faza -->
<div class="card">
<h2>Aktualna faza cyklu</h2>
<div id="currentPhase" class="phase"></div>
<p><strong>Dzień cyklu:</strong> <span id="cycleDay"></span></p>
<p><strong>Owulacja:</strong> <span id="ovulationDate"></span></p>
<p><strong>Dni płodne:</strong> <span id="fertileDays"></span></p>
<p><strong>Następny okres:</strong> <span id="nextPeriod"></span></p>
</div>

<!-- Rekomendacje -->
<div class="card tips">
<h2>Rekomendacje</h2>
<p><strong>Menu dzienne:</strong></p>
<div id="foodAccordion"></div>
<p><strong>Wellness:</strong></p>
<div id="wellnessAccordion"></div>
</div>
<p><strong>Intymność:</strong></p>
<div id="intimacyAccordion"></div>

<!-- Kalendarz -->
<div class="card">
<h2>Kalendarz ostatniego cyklu</h2>
<div id="calendar" class="calendar"></div>
</div>

<!-- Historia cykli -->
<div class="card">
<h2>Historia cykli</h2>
<table>
<thead><tr><th>Początek</th><th>Koniec</th><th>Długość krwawienia</th></tr></thead>
<tbody id="historyTable"></tbody>
</table>
</div>

<!-- Dodawanie nowego okresu -->
<div class="card">
<h2>Dodaj nowy okres</h2>
<label for="startDate">Początek okresu:</label>
<input type="date" id="startDate">
<label for="endDate">Koniec okresu:</label>
<input type="date" id="endDate">
<button onclick="addPeriod()">Dodaj okres</button>
</div>

</div>

<!-- Modal na kliknięcie w dzień -->
<div id="dayModal">
  <div class="modal-content">
    <button id="closeModal">✕</button>
    <h3 id="modalDate"></h3>
    <p id="modalPhase"></p>
    <div id="modalFood"></div>
    <div id="modalWellness"></div>
  </div>
</div>

<!-- Opcjonalnie eksport / import JSON historii cykli -->
<div class="container">
  <div class="card">
    <h2>Eksport / Import historii</h2>
    <button onclick="exportHistory()">Eksportuj JSON</button>
    <input type="file" id="importFile" accept=".json">
    <button onclick="importHistory()">Importuj JSON</button>
  </div>
</div>

<script>
const periods = [
  { start: '2025-01-07', end: '2025-01-10' },
  { start: '2025-01-30', end: '2025-02-02' },
  { start: '2025-02-24', end: '2025-02-27' },
  { start: '2025-03-23', end: '2025-03-26' },
  { start: '2025-04-16', end: '2025-04-19' },
  { start: '2025-05-12', end: '2025-05-15' },
  { start: '2025-06-04', end: '2025-06-07' },
  { start: '2025-06-28', end: '2025-07-01' },
  { start: '2025-07-24', end: '2025-07-27' },
  { start: '2025-08-18', end: '2025-08-21' },
  { start: '2025-09-12', end: '2025-09-15' },
  { start: '2025-10-08', end: '2025-10-11' },
  { start: '2025-10-30', end: '2025-11-02' },
  { start: '2025-11-25', end: '2025-11-28' },
  { start: '2025-12-19', end: '2025-12-22' }
];

const tips = {
  menstruacja: { food:['Szpinak z jajkiem','Sałatka z burakami','Smoothie malinowe'], exercise:['Lekki spacer','Rozciąganie'], mood:'Zmęczenie' },
  folikularna: { food:['Jajka z warzywami','Owsianka','Sałatka z kurczakiem'], exercise:['Trening siłowy','Cardio'], mood:'Dużo energii' },
  owulacja: { food:['Owoce sezonowe','Orzechy','Smoothie jagodowe'], exercise:['Intensywny trening','Taniec'], mood:'Pewność siebie' },
  lutealna: { food:['Czekolada','Banany','Produkty bogate w magnez'], exercise:['Joga','Spacery'], mood:'Wahania nastroju' }
};

let quotesTipsData = {};
fetch('quotesTips.json').then(r=>r.json()).then(data=>{ quotesTipsData = data; updateUI(); });
let foodData={}, wellnessData={};
fetch('foodTips.json').then(r=>r.json()).then(data=>{ foodData=data; updateUI(); });
fetch('wellnessTips.json').then(r=>r.json()).then(data=>{ wellnessData=data; updateUI(); });
let intimacyData = {};
fetch('intimacyTips.json')
  .then(r => r.json())
  .then(data => { intimacyData = data; updateUI(); })
  .catch(err => console.error('Nie udało się załadować tipów intymności:', err));

function parseDate(str){return new Date(str+'T00:00:00');}
function formatDate(date){return date.toISOString().split('T')[0];}
function calculateAverageCycle(periods){let total=0; for(let i=1;i<periods.length;i++){total+=(parseDate(periods[i].start)-parseDate(periods[i-1].start))/(1000*60*60*24);} return Math.round(total/(periods.length-1));}
function getCycleInfo(periods){
  const avgCycle=calculateAverageCycle(periods);
  const lastPeriod=parseDate(periods[periods.length-1].start);
  const today=new Date();
  const dayOfCycle=Math.floor((today-lastPeriod)/(1000*60*60*24))+1;
  const ovulationDay=13;
  const fertileStart=new Date(lastPeriod); fertileStart.setDate(fertileStart.getDate()+ovulationDay-5);
  const fertileEnd=new Date(lastPeriod); fertileEnd.setDate(fertileEnd.getDate()+ovulationDay);
  const ovulationDate=new Date(lastPeriod); ovulationDate.setDate(ovulationDate.getDate()+ovulationDay);
  const nextPeriod=new Date(lastPeriod); nextPeriod.setDate(nextPeriod.getDate()+avgCycle);
  let phase='',phaseClass='';
  if(dayOfCycle<=4){phase='menstruacja';phaseClass='menstruacja';}
  else if(dayOfCycle<=ovulationDay-2){phase='folikularna';phaseClass='folikularna';}
  else if(dayOfCycle===ovulationDay||dayOfCycle===ovulationDay-1){phase='owulacja';phaseClass='owulacja';}
  else{phase='lutealna';phaseClass='lutealna';}
  return {
    phase,phaseClass,dayOfCycle,
    fertileDays:[formatDate(fertileStart),formatDate(fertileEnd)],
    ovulationDate:formatDate(ovulationDate),
    nextPeriod:formatDate(nextPeriod),
    tips: tips[phase],
    quote: quotesTipsData[phase]?.quotes?.[Math.floor(Math.random()*(quotesTipsData[phase]?.quotes?.length||1))]||'',
    wellnessTip: quotesTipsData[phase]?.tips?.[Math.floor(Math.random()*(quotesTipsData[phase]?.tips?.length||1))]||''
  };
}

function updateHistory(){
  const tbody=document.getElementById('historyTable'); tbody.innerHTML='';
  periods.forEach(p=>{
    const len=(parseDate(p.end)-parseDate(p.start))/(1000*60*60*24)+1;
    tbody.innerHTML+=`<tr><td>${p.start}</td><td>${p.end}</td><td>${len}</td></tr>`;
  });
}

function updateCalendar(){
  const calendar=document.getElementById('calendar'); calendar.innerHTML='';
  const lastPeriod=parseDate(periods[periods.length-1].start);
  const avgCycle=calculateAverageCycle(periods);
  for(let i=0;i<avgCycle;i++){
    const day=new Date(lastPeriod); day.setDate(day.getDate()+i);
    let cls='';
    if(i<4) cls='menstruacja-day';
    else if(i<12) cls='folikularna-day';
    else if(i===12||i===11) cls='owulacja-day';
    else cls='lutealna-day';
    calendar.innerHTML+=`<div class='day ${cls}' title='${formatDate(day)}' onclick='showDayModal("${formatDate(day)}","${cls}")'>${day.getDate()}</div>`;
  }
}

// Akordeon
function createAccordion(containerId, data){
  const container=document.getElementById(containerId); container.innerHTML='';
  for(const key in data){
    const div=document.createElement('div');
    div.innerHTML=`<button class="accordion-btn" onclick="this.nextElementSibling.classList.toggle('active')">${key}</button>
      <ul class="accordion-content">${data[key].map(item=>`<li>${item}</li>`).join('')}</ul>`;
    container.appendChild(div);
  }
}

function updateUI(){
  if(!quotesTipsData || !foodData || !wellnessData) return;
  const info=getCycleInfo(periods);
  const phaseDiv=document.getElementById('currentPhase'); 
  phaseDiv.textContent=info.phase.toUpperCase(); 
  phaseDiv.className=`phase ${info.phaseClass}`;
  document.getElementById('cycleDay').textContent=info.dayOfCycle;
  document.getElementById('ovulationDate').textContent=info.ovulationDate;
  document.getElementById('fertileDays').textContent=`${info.fertileDays[0]} - ${info.fertileDays[1]}`;
  document.getElementById('nextPeriod').textContent=info.nextPeriod;
  createAccordion('foodAccordion', foodData[info.phase]);
  createAccordion('wellnessAccordion', wellnessData[info.phase]);
  createAccordion('intimacyAccordion', intimacyData[info.phase]);
  document.getElementById('dailyQuote').textContent=info.quote;
  document.getElementById('dailyTip').textContent=info.wellnessTip;
  updateHistory();
  updateCalendar();
}

function addPeriod(){
  const start=document.getElementById('startDate').value;
  const end=document.getElementById('endDate').value;
  if(start&&end){periods.push({start,end});updateUI();alert('Dodano okres!');}
  else alert('Wprowadź obie daty.');
}

// --- Modal ---
function showDayModal(date, phaseClass){
  const info=getCycleInfo(periods);
  let phase='';
  if(phaseClass.includes('menstruacja')) phase='menstruacja';
  else if(phaseClass.includes('folikularna')) phase='folikularna';
  else if(phaseClass.includes('owulacja')) phase='owulacja';
  else phase='lutealna';
  const modal=document.getElementById('dayModal');
  document.getElementById('modalDate').textContent=date;
  document.getElementById('modalPhase').textContent='Faza: '+phase.toUpperCase();
  createAccordion('modalFood', foodData[phase]);
  createAccordion('modalWellness', wellnessData[phase]);
  createAccordion('modalIntimacy', intimacyData[phase]);
  modal.style.display='flex';
}
document.getElementById('closeModal').addEventListener('click',()=>{document.getElementById('dayModal').style.display='none';});

// Service Worker
if('serviceWorker' in navigator){navigator.serviceWorker.register('service-worker.js').then(()=>console.log('SW zarejestrowany'));}
// --- LocalStorage ---
function saveHistory(){
  localStorage.setItem('cycleHistory', JSON.stringify(periods));
}

function loadHistory(){
  const data = localStorage.getItem('cycleHistory');
  if(data){
    try{
      const arr = JSON.parse(data);
      if(Array.isArray(arr)) periods.splice(0, periods.length, ...arr);
    }catch(e){ console.error('Błąd wczytywania historii:', e);}
  }
}

// --- Eksport / Import JSON ---
function exportHistory(){
  const dataStr = JSON.stringify(periods, null, 2);
  const blob = new Blob([dataStr], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'cycleHistory.json';
  a.click();
  URL.revokeObjectURL(url);
}

function importHistory(){
  const file = document.getElementById('importFile').files[0];
  if(!file) return alert('Wybierz plik JSON!');
  const reader = new FileReader();
  reader.onload = e => {
    try{
      const arr = JSON.parse(e.target.result);
      if(Array.isArray(arr)){
        periods.splice(0, periods.length, ...arr);
        saveHistory();
        updateUI();
        alert('Historia zaimportowana!');
      }else alert('Niepoprawny format JSON!');
    }catch(err){ alert('Błąd parsowania JSON'); }
  };
  reader.readAsText(file);
}

// --- Na starcie wczytanie historii ---
loadHistory();
updateUI();

// Dodaj w addPeriod() też zapisywanie do localStorage
function addPeriod(){
  const start=document.getElementById('startDate').value;
  const end=document.getElementById('endDate').value;
  if(start && end){
    periods.push({start,end});
    saveHistory();
    updateUI();
    alert('Dodano okres!');
  }else alert('Wprowadź obie daty.');
}
</script>
</body>
</html>
