<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Twój Cykl - Asystent Kobiecy Rozbudowany</title>
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
  body { font-family: 'Helvetica Neue', Arial, sans-serif; margin:0; background:#fafafa; color:#333; transition: background 0.3s, color 0.3s; }
  header { background: linear-gradient(90deg,#ff7a7a,#ff5e62); color:white; padding:1.5rem; text-align:center; }
  h1 { margin:0; font-size:1.6rem; }
  .container { padding:1rem; max-width:600px; margin:auto; }
  .card { background:white; border-radius:16px; box-shadow:0 2px 8px rgba(0,0,0,0.1); padding:1rem; margin-bottom:1rem; }
  .phase { padding:1rem; border-radius:12px; color:white; font-weight:bold; text-align:center; transition: background 0.3s; }
  .menstruacja { background:#ff4d6d; }
  .folikularna { background:#6fcf97; }
  .owulacja { background:#56ccf2; }
  .lutealna { background:#bb6bd9; }
  label { display:block; margin-top:0.5rem; font-weight:bold; }
  input { padding:0.5rem; width:100%; margin-top:0.25rem; border-radius:8px; border:1px solid #ddd; }
  button { padding:0.7rem 1.2rem; margin-top:1rem; background:#ff6f61; color:white; border:none; border-radius:10px; cursor:pointer; width:100%; font-weight:bold; }
  button:hover { background:#ff8a80; }
  table { width:100%; border-collapse:collapse; margin-top:0.5rem; }
  th, td { padding:0.5rem; border:1px solid #ddd; text-align:center; }
  th { background:#f0f0f0; }
  .calendar { display:grid; grid-template-columns: repeat(7, 1fr); gap:4px; margin-top:1rem; }
  .day { padding:8px; border-radius:8px; text-align:center; font-size:0.85rem; transition: background 0.3s; cursor:pointer; }
  .menstruacja-day { background:#ff4d6d; color:white; }
  .folikularna-day { background:#6fcf97; color:white; }
  .owulacja-day { background:#56ccf2; color:white; }
  .lutealna-day { background:#bb6bd9; color:white; }

  /* Styl Cytatu i Porady dnia */
  .daily-card { background: linear-gradient(135deg,#ff9a9e,#fad0c4); color:#fff; text-align:center; padding:2rem; font-size:1.1rem; line-height:1.5; margin-bottom:1rem; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
  .daily-card p { margin:0.5rem 0; }
  .daily-card .quote { font-style:italic; font-size:1.2rem; }
  .daily-card .tip { font-weight:bold; font-size:1.1rem; }
</style>
</head>
<body>
<header>
<h1>Twój Cykl - Asystent Kobiecy Rozbudowany</h1>
</header>
<div class="container">

<!-- Cytat dnia i Porada dnia na samej górze -->
<div class="card daily-card">
  <p class="quote" id="dailyQuote"></p>
  <p class="tip" id="dailyTip"></p>
</div>

<!-- Aktualna faza -->
<div class="card">
<h2>Aktualna faza cyklu</h2>
<div id="currentPhase" class="phase"></div>
<p><strong>Dzień cyklu:</strong> <span id="cycleDay"></span></p>
<p><strong>Owulacja:</strong> <span id="ovulationDate"></span></p>
<p><strong>Dni płodne:</strong> <span id="fertileDays"></span></p>
<p><strong>Następny okres:</strong> <span id="nextPeriod"></span></p>
</div>

<!-- Rekomendacje -->
<div class="card tips">
<h2>Rekomendacje</h2>
<p><strong>Żywienie:</strong></p>
<ul id="foodList"></ul>
<p><strong>Trening:</strong></p>
<ul id="exerciseList"></ul>
<p><strong>Samopoczucie:</strong> <span id="mood"></span></p>
</div>

<!-- Kalendarz -->
<div class="card">
<h2>Kalendarz ostatniego cyklu</h2>
<div id="calendar" class="calendar"></div>
</div>

<!-- Historia cykli -->
<div class="card">
<h2>Historia cykli</h2>
<table>
<thead><tr><th>Początek</th><th>Koniec</th><th>Długość krwawienia</th></tr></thead>
<tbody id="historyTable"></tbody>
</table>
</div>

<!-- Dodawanie nowego okresu -->
<div class="card">
<h2>Dodaj nowy okres</h2>
<label for="startDate">Początek okresu:</label>
<input type="date" id="startDate">
<label for="endDate">Koniec okresu:</label>
<input type="date" id="endDate">
<button onclick="addPeriod()">Dodaj okres</button>
</div>

</div>

<script>
const periods = [
  { start: '2025-01-07', end: '2025-01-10' },
  { start: '2025-01-30', end: '2025-02-02' },
  { start: '2025-02-24', end: '2025-02-27' },
  { start: '2025-03-23', end: '2025-03-26' },
  { start: '2025-04-16', end: '2025-04-19' },
  { start: '2025-05-12', end: '2025-05-15' },
  { start: '2025-06-04', end: '2025-06-07' },
  { start: '2025-06-28', end: '2025-07-01' },
  { start: '2025-07-24', end: '2025-07-27' },
  { start: '2025-08-18', end: '2025-08-21' },
  { start: '2025-09-12', end: '2025-09-15' },
  { start: '2025-10-08', end: '2025-10-11' },
  { start: '2025-10-30', end: '2025-11-02' },
  { start: '2025-11-25', end: '2025-11-28' },
  { start: '2025-12-19', end: '2025-12-22' }
];

const tips = {
  menstruacja: {
    food: ['Szpinak z jajkiem','Sałatka z burakami i soczewicą','Smoothie z malinami i bananem'],
    exercise: ['Lekki spacer 30 min','Delikatne rozciąganie'],
    mood: 'Zmęczenie, potrzeba odpoczynku'
  },
  folikularna: {
    food: ['Jajka na miękko z warzywami','Owsianka z owocami','Sałatka z kurczakiem i awokado'],
    exercise: ['Trening siłowy 40 min','Cardio 30 min'],
    mood: 'Dużo energii, wysoka motywacja'
  },
  owulacja: {
    food: ['Owoce sezonowe','Orzechy i migdały','Smoothie z jagodami'],
    exercise: ['Intensywny trening 45 min','Taniec lub aerobik'],
    mood: 'Pewność siebie, wysoki poziom libido'
  },
  lutealna: {
    food: ['Ciemna czekolada','Banany','Produkty bogate w magnez'],
    exercise: ['Joga 30 min','Spacery 30 min'],
    mood: 'Wahania nastroju, PMS'
  }
};

// --- Wczytywanie cytatów i porad z JSON ---
let quotesTipsData = {};
fetch('quotesTips.json')
  .then(response => response.json())
  .then(data => {
    quotesTipsData = data;
    updateUI(); // aktualizacja UI po załadowaniu JSON
  })
  .catch(err => console.error('Nie udało się załadować cytatów i porad:', err));

// --- Funkcje pomocnicze ---
function parseDate(str){return new Date(str+'T00:00:00');}
function formatDate(date){return date.toISOString().split('T')[0];}
function calculateAverageCycle(periods){
  let total=0;
  for(let i=1;i<periods.length;i++){
    total+=(parseDate(periods[i].start)-parseDate(periods[i-1].start))/(1000*60*60*24);
  }
  return Math.round(total/(periods.length-1));
}

function getCycleInfo(periods){
  const avgCycle=calculateAverageCycle(periods);
  const lastPeriod=parseDate(periods[periods.length-1].start);
  const today=new Date();
  const dayOfCycle=Math.floor((today-lastPeriod)/(1000*60*60*24))+1;
  const ovulationDay=13;

  const fertileStart=new Date(lastPeriod); fertileStart.setDate(fertileStart.getDate()+ovulationDay-5);
  const fertileEnd=new Date(lastPeriod); fertileEnd.setDate(fertileEnd.getDate()+ovulationDay);
  const ovulationDate=new Date(lastPeriod); ovulationDate.setDate(ovulationDate.getDate()+ovulationDay);
  const nextPeriod=new Date(lastPeriod); nextPeriod.setDate(nextPeriod.getDate()+avgCycle);

  let phase='',phaseClass='';
  if(dayOfCycle<=4){phase='menstruacja';phaseClass='menstruacja';}
  else if(dayOfCycle<=ovulationDay-2){phase='folikularna';phaseClass='folikularna';}
  else if(dayOfCycle===ovulationDay||dayOfCycle===ovulationDay-1){phase='owulacja';phaseClass='owulacja';}
  else{phase='lutealna';phaseClass='lutealna';}

  return {
    phase,phaseClass,dayOfCycle,
    fertileDays:[formatDate(fertileStart),formatDate(fertileEnd)],
    ovulationDate:formatDate(ovulationDate),
    nextPeriod:formatDate(nextPeriod),
    tips: tips[phase],
    quote: quotesTipsData[phase]?.quotes?.[Math.floor(Math.random()*(quotesTipsData[phase]?.quotes?.length||1))]||'',
    wellnessTip: quotesTipsData[phase]?.tips?.[Math.floor(Math.random()*(quotesTipsData[phase]?.tips?.length||1))]||''
  };
}

function updateHistory(){
  const tbody=document.getElementById('historyTable'); tbody.innerHTML='';
  periods.forEach(p=>{
    const len=(parseDate(p.end)-parseDate(p.start))/(1000*60*60*24)+1;
    tbody.innerHTML+=`<tr><td>${p.start}</td><td>${p.end}</td><td>${len}</td></tr>`;
  });
}

function showDayDetails(date, phaseClass){
  let phase='';
  if(phaseClass.includes('menstruacja')) phase='menstruacja';
  else if(phaseClass.includes('folikularna')) phase='folikularna';
  else if(phaseClass.includes('owulacja')) phase='owulacja';
  else phase='lutealna';
  const dayTips = tips[phase];
  alert(`${date}\nFaza: ${phase}\nŻywienie: ${dayTips.food.join(', ')}\nTrening: ${dayTips.exercise.join(', ')}\nSamopoczucie: ${dayTips.mood}`);
}

function updateCalendar(){
  const calendar=document.getElementById('calendar'); calendar.innerHTML='';
  const lastPeriod=parseDate(periods[periods.length-1].start);
  const avgCycle=calculateAverageCycle(periods);
  for(let i=0;i<avgCycle;i++){
    const day=new Date(lastPeriod); day.setDate(day.getDate()+i);
    let cls='';
    if(i<4) cls='menstruacja-day';
    else if(i<12) cls='folikularna-day';
    else if(i===12||i===11) cls='owulacja-day';
    else cls='lutealna-day';
    calendar.innerHTML+=`<div class='day ${cls}' title='${formatDate(day)}' onclick='showDayDetails("${formatDate(day)}","${cls}")'>${day.getDate()}</div>`;
  }
}

function updateUI(){
  const info=getCycleInfo(periods);
  const phaseDiv=document.getElementById('currentPhase'); 
  phaseDiv.textContent=info.phase.toUpperCase(); 
  phaseDiv.className=`phase ${info.phaseClass}`;

  document.getElementById('cycleDay').textContent=info.dayOfCycle;
  document.getElementById('ovulationDate').textContent=info.ovulationDate;
  document.getElementById('fertileDays').textContent=`${info.fertileDays[0]} - ${info.fertileDays[1]}`;
  document.getElementById('nextPeriod').textContent=info.nextPeriod;

  const foodList=document.getElementById('foodList'); foodList.innerHTML='';
  info.tips.food.forEach(f=>foodList.innerHTML+=`<li>${f}</li>`);
  const exerciseList=document.getElementById('exerciseList'); exerciseList.innerHTML='';
  info.tips.exercise.forEach(e=>exerciseList.innerHTML+=`<li>${e}</li>`);
  document.getElementById('mood').textContent=info.tips.mood;

  document.getElementById('dailyQuote').textContent=info.quote;
  document.getElementById('dailyTip').textContent=info.wellnessTip;

  updateHistory(); 
  updateCalendar();
}

function addPeriod(){
  const start=document.getElementById('startDate').value;
  const end=document.getElementById('endDate').value;
  if(start&&end){periods.push({start,end});updateUI();alert('Dodano okres!');}
  else alert('Wprowadź obie daty.');
}

// --- Service Worker ---
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js').then(()=>console.log('Service Worker zarejestrowany'));
}
  // ======== EXPORT / IMPORT DANYCH ========

// Funkcja eksportu danych (backup historii cykli + cytaty i porady)
function exportAppData() {
  const dataToExport = {
    periods: periods,
    quotesTipsData: quotesTipsData
  };
  const dataStr = JSON.stringify(dataToExport, null, 2);
  const blob = new Blob([dataStr], { type: "application/json" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "cycleAppData.json";
  a.click();
  URL.revokeObjectURL(url);
}

// Funkcja importu danych z pliku JSON
function importAppData(file) {
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const imported = JSON.parse(e.target.result);
      if(imported.periods) periods.length = 0, periods.push(...imported.periods);
      if(imported.quotesTipsData) quotesTipsData = imported.quotesTipsData;
      updateUI();
      alert("Dane zostały zaimportowane poprawnie!");
    } catch (err) {
      console.error(err);
      alert("Błąd przy imporcie danych JSON.");
    }
  };
  reader.readAsText(file);
}

// ======== DODAJ PRZYCISKI DO INTERFEJSU ========

// Stworzymy kontener na koniec appki
const container=document.querySelector('.container');
const backupCard = document.createElement('div');
backupCard.className = 'card';
backupCard.innerHTML = `
  <h2>Eksport / Import danych</h2>
  <button onclick="exportAppData()">Eksportuj dane do JSON</button>
  <label for="importFile" style="margin-top:0.5rem;font-weight:bold;">Importuj dane z JSON:</label>
  <input type="file" id="importFile" accept=".json">
`;
container.appendChild(backupCard);

// Obsługa input importu
document.getElementById('importFile').addEventListener('change', function() {
  if(this.files.length>0) importAppData(this.files[0]);
});

</script>
</body>
</html>
