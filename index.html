<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Twój Cykl - Asystent Kobiecy Rozbudowany</title>
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
<meta name="mobile-web-app-capable" content="yes">
<style>
  body { font-family: 'Helvetica Neue', Arial, sans-serif; margin:0; background:#fafafa; color:#333; transition: background 0.3s, color 0.3s; }
  header { background: linear-gradient(90deg,#ff7a7a,#ff5e62); color:white; padding:1.5rem; text-align:center; }
  h1 { margin:0; font-size:1.6rem; }
  .container { padding:1rem; max-width:600px; margin:auto; }
  .card { background:white; border-radius:16px; box-shadow:0 2px 8px rgba(0,0,0,0.1); padding:1rem; margin-bottom:1rem; }
  .phase { padding:1rem; border-radius:12px; color:white; font-weight:bold; text-align:center; transition: background 0.3s; }
  .menstruacja { background:#ff4d6d; }
  .folikularna { background:#6fcf97; }
  .owulacja { background:#56ccf2; }
  .lutealna { background:#bb6bd9; }
  label { display:block; margin-top:0.5rem; font-weight:bold; }
  input { padding:0.5rem; width:100%; margin-top:0.25rem; border-radius:8px; border:1px solid #ddd; }
  button { padding:0.7rem 1.2rem; margin-top:1rem; background:#ff6f61; color:white; border:none; border-radius:10px; cursor:pointer; width:100%; font-weight:bold; }
  button:hover { background:#ff8a80; }
  table { width:100%; border-collapse:collapse; margin-top:0.5rem; }
  th, td { padding:0.5rem; border:1px solid #ddd; text-align:center; }
  th { background:#f0f0f0; }
  .calendar { display:grid; grid-template-columns: repeat(7, 1fr); gap:4px; margin-top:1rem; }
  .day { padding:8px; border-radius:8px; text-align:center; font-size:0.85rem; transition: background 0.3s; cursor:pointer; }
  .menstruacja-day { background:#ff4d6d; color:white; }
  .folikularna-day { background:#6fcf97; color:white; }
  .owulacja-day { background:#56ccf2; color:white; }
  .lutealna-day { background:#bb6bd9; color:white; }

  /* Cytat i Porada dnia */
  .daily-card { background: linear-gradient(135deg,#ff9a9e,#fad0c4); color:#fff; text-align:center; padding:2rem; font-size:1.1rem; line-height:1.5; margin-bottom:1rem; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
  .daily-card p { margin:0.5rem 0; }
  .daily-card .quote { font-style:italic; font-size:1.2rem; }
  .daily-card .tip { font-weight:bold; font-size:1.1rem; }

  /* Akordeony */
  .accordion-btn { width: 100%; text-align: left; padding: 0.5rem 1rem; font-weight: bold;
                   background: linear-gradient(90deg, #ff7a7a, #ff5e62); color:white; border:none; border-radius:8px; margin-top:0.5rem; cursor:pointer; }
  .accordion-btn:hover { background: linear-gradient(90deg, #ff8a80, #ff6f61); }
  .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; margin: 0.25rem 0 0 0; padding-left:1rem; list-style-type: disc; }
  .accordion-content.active { max-height: 500px; }

  /* Modal */
  #dayModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; justify-content:center; align-items:center; }
  #dayModal .modal-content { background:white; border-radius:16px; max-width:500px; width:90%; padding:1rem; position:relative; max-height:80vh; overflow-y:auto; }
  #closeModal { position:absolute; top:10px; right:10px; background:#ff6f61; color:white; border:none; border-radius:50%; width:30px; height:30px; cursor:pointer; }
.intimacy-tip {
  background: linear-gradient(135deg,#ff9a9e,#fad0c4);
  color: #fff;
  padding: 0.7rem 1rem;
  margin: 0.5rem 0;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  font-size: 0.95rem;
}
  .calendar-nav button {
  background: linear-gradient(90deg, #ff7a7a, #ff5e62);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 0.5rem 1rem;
  margin: 0.3rem;
  font-weight: bold;
  cursor: pointer;
}
.calendar-nav button:hover {
  background: linear-gradient(90deg, #ff8a80, #ff6f61);
}
.symptom-card {
  background: #fff5f5;
  border-left: 4px solid #ff5e62;
  padding: 0.5rem 1rem;
  margin-top: 0.5rem;
  border-radius: 8px;
  color: #333;
}

</style>
</head>
<body>
<header>
<h1>Twój Cykl - Asystent Kobiecy Rozbudowany</h1>
</header>
<div class="container">

<div class="card daily-card">
  <p class="quote" id="dailyQuote"></p>
  <p class="tip" id="dailyTip"></p>
</div>

<div class="card">
<h2>Aktualna faza cyklu</h2>
<div id="currentPhase" class="phase"></div>
<p><strong>Dzień cyklu:</strong> <span id="cycleDay"></span></p>
<p><strong>Owulacja:</strong> <span id="ovulationDate"></span></p>
<p><strong>Dni płodne:</strong> <span id="fertileDays"></span></p>
<p><strong>Następny okres:</strong> <span id="nextPeriod"></span></p>
</div>

<div class="card tips">
<h2>Rekomendacje</h2>
<p><strong>Menu dzienne:</strong></p>
<div id="foodAccordion"></div>
<p><strong>Wellness:</strong></p>
<div id="wellnessAccordion"></div>
<p><strong>Intymność:</strong></p>
<div id="intimacyAccordion"></div>
</div>

<div class="card">
  <h2>Kalendarz cykli</h2>
  <div id="calendar" class="calendar"></div>
  <div class="calendar-nav" style="text-align:center; margin-top:10px;">
    <button onclick="showPreviousCycle()">◀ Poprzedni cykl</button>
    <button onclick="showNextCycle()">Następny cykl ▶</button>
  </div>
</div>
<div class="card">
  <h2>Objawy dnia</h2>
  <label>Ból brzucha:</label>
  <input type="range" min="0" max="10" id="painLevel">
  
  <label>Nastrój:</label>
  <select id="moodSelect">
    <option>Dobry</option>
    <option>Neutralny</option>
    <option>Zły</option>
  </select>
  
  <label>Energia:</label>
  <input type="range" min="0" max="10" id="energyLevel">
  
  <label>Inne objawy:</label>
  <textarea id="otherSymptoms" placeholder="np. bóle głowy, obrzmienie, senność..."></textarea>

  <button onclick="saveSymptoms()">Zapisz objawy</button>
</div>


<div class="card">
<h2>Historia cykli</h2>
<table>
<thead><tr><th>Początek</th><th>Koniec</th><th>Długość krwawienia</th></tr></thead>
<tbody id="historyTable"></tbody>
</table>
</div>

<div class="card">
<h2>Dodaj nowy okres</h2>
<label for="startDate">Początek okresu:</label>
<input type="date" id="startDate">
<label for="endDate">Koniec okresu:</label>
<input type="date" id="endDate">
<button onclick="addPeriod()">Dodaj okres</button>
</div>

<div class="card">
<h2>Eksport / Import historii</h2>
<button onclick="exportHistory()">Eksportuj JSON</button>
<input type="file" id="importFile" accept=".json">
<button onclick="importHistory()">Importuj JSON</button>
</div>

</div>

<div id="dayModal">
  <div class="modal-content">
    <button id="closeModal">✕</button>
    <h3 id="modalDate"></h3>
    <p id="modalPhase"></p>
    <div id="modalFood"></div>
    <div id="modalWellness"></div>
    <div id="modalSymptoms"></div>
    <div id="modalIntimacy"></div>
  </div>
</div>

<script>
// --- Dane i wczytywanie JSON ---
const periods = [
  { start: '2025-01-07', end: '2025-01-10' },
  { start: '2025-01-30', end: '2025-02-02' },
  { start: '2025-02-24', end: '2025-02-27' },
  { start: '2025-03-23', end: '2025-03-26' },
  { start: '2025-04-16', end: '2025-04-19' },
  { start: '2025-05-12', end: '2025-05-15' },
  { start: '2025-06-04', end: '2025-06-07' },
  { start: '2025-06-28', end: '2025-07-01' },
  { start: '2025-07-24', end: '2025-07-27' },
  { start: '2025-08-18', end: '2025-08-21' },
  { start: '2025-09-12', end: '2025-09-15' },
  { start: '2025-10-08', end: '2025-10-11' },
  { start: '2025-10-30', end: '2025-11-02' },
  { start: '2025-11-25', end: '2025-11-28' },
  { start: '2025-12-19', end: '2025-12-22' }
];
const tips = {
  menstruacja: { food:['Szpinak z jajkiem','Sałatka z burakami','Smoothie malinowe'], exercise:['Lekki spacer','Rozciąganie'], mood:'Zmęczenie' },
  folikularna: { food:['Jajka z warzywami','Owsianka','Sałatka z kurczakiem'], exercise:['Trening siłowy','Cardio'], mood:'Dużo energii' },
  owulacja: { food:['Owoce sezonowe','Orzechy','Smoothie jagodowe'], exercise:['Intensywny trening','Taniec'], mood:'Pewność siebie' },
  lutealna: { food:['Czekolada','Banany','Produkty bogate w magnez'], exercise:['Joga','Spacery'], mood:'Wahania nastroju' }
};

let quotesTipsData={}, foodData={}, wellnessData={}, intimacyData={};
fetch('quotesTips.json').then(r=>r.json()).then(d=>{ quotesTipsData=d; updateUI(); });
fetch('foodTips.json').then(r=>r.json()).then(d=>{ foodData=d; updateUI(); });
fetch('wellnessTips.json').then(r=>r.json()).then(d=>{ wellnessData=d; updateUI(); });
fetch('intimacyTips.json').then(r=>r.json()).then(d=>{ intimacyData=d; updateUI(); })
.catch(err=>console.error('Nie udało się załadować tipów intymności:', err));

function parseDate(str){return new Date(str+'T00:00:00');}
function formatDate(d){return d.toISOString().split('T')[0];}

function calculateAverageCycle(periods){
  let total=0;
  for(let i=1;i<periods.length;i++){
    total += (parseDate(periods[i].start)-parseDate(periods[i-1].start))/(1000*60*60*24);
  }
  return Math.round(total/(periods.length-1));
}

function getCycleInfo(periods){
  const avgCycle = calculateAverageCycle(periods);
  const lastPeriod = parseDate(periods[periods.length-1].start);
  const today = new Date();
  const dayOfCycle = Math.floor((today-lastPeriod)/(1000*60*60*24))+1;
  const ovulationDay = 13;
  const fertileStart = new Date(lastPeriod); fertileStart.setDate(fertileStart.getDate()+ovulationDay-5);
  const fertileEnd = new Date(lastPeriod); fertileEnd.setDate(fertileEnd.getDate()+ovulationDay);
  const ovulationDate = new Date(lastPeriod); ovulationDate.setDate(ovulationDate.getDate()+ovulationDay);
  const nextPeriod = new Date(lastPeriod); nextPeriod.setDate(nextPeriod.getDate()+avgCycle);

  let phase='', phaseClass='';
  if(dayOfCycle<=4){phase='menstruacja';phaseClass='menstruacja';}
  else if(dayOfCycle<=ovulationDay-2){phase='folikularna';phaseClass='folikularna';}
  else if(dayOfCycle===ovulationDay||dayOfCycle===ovulationDay-1){phase='owulacja';phaseClass='owulacja';}
  else{phase='lutealna';phaseClass='lutealna';}

  return { phase, phaseClass, dayOfCycle, fertileDays:[formatDate(fertileStart),formatDate(fertileEnd)], ovulationDate:formatDate(ovulationDate), nextPeriod:formatDate(nextPeriod) };
}

// --- Losowe elementy ---
function getRandomItems(arr,n=1){ if(!arr || !arr.length) return []; return [...arr].sort(()=>0.5-Math.random()).slice(0,n); }

function createAccordion(containerId,data,randomize=false){
  const container=document.getElementById(containerId); container.innerHTML='';
  if(!data) return;
  if(Array.isArray(data)){
    const items = randomize ? getRandomItems(data,1) : data;
    const ul = document.createElement('ul'); ul.className='accordion-content active';
    ul.innerHTML = items.map(i=>`<li>${i}</li>`).join('');
    container.appendChild(ul);
    return;
  }
  for(const key in data){
    if(!Array.isArray(data[key])) continue;
    const items = randomize ? getRandomItems(data[key],1) : data[key];
    const div=document.createElement('div');
    div.innerHTML=`<button class="accordion-btn" onclick="this.nextElementSibling.classList.toggle('active')">${key}</button>
      <ul class="accordion-content">${items.map(i=>`<li>${i}</li>`).join('')}</ul>`;
    container.appendChild(div);
  }
}

// --- Aktualizacja UI ---
function updateUI(){
  const info=getCycleInfo(periods);
  const phaseDiv=document.getElementById('currentPhase');
  phaseDiv.textContent=info.phase.toUpperCase();
  phaseDiv.className=`phase ${info.phaseClass}`;

  document.getElementById('cycleDay').textContent=info.dayOfCycle;
  document.getElementById('ovulationDate').textContent=info.ovulationDate;
  document.getElementById('fertileDays').textContent=`${info.fertileDays[0]} - ${info.fertileDays[1]}`;
  document.getElementById('nextPeriod').textContent=info.nextPeriod;

  createAccordion('foodAccordion', foodData[info.phase], true);
  createAccordion('wellnessAccordion', wellnessData[info.phase], true);
  const intimacyTips = intimacyData[info.phase] || [];
const randomIntimacyTip = intimacyTips[Math.floor(Math.random() * intimacyTips.length)] || '';
document.getElementById('intimacyAccordion').innerHTML = `<div class="intimacy-tip">${randomIntimacyTip}</div>`;


  document.getElementById('dailyQuote').textContent=quotesTipsData[info.phase]?.quotes?.[Math.floor(Math.random()*(quotesTipsData[info.phase]?.quotes?.length||1))]||'';
  document.getElementById('dailyTip').textContent=quotesTipsData[info.phase]?.tips?.[Math.floor(Math.random()*(quotesTipsData[info.phase]?.tips?.length||1))]||'';

  updateHistory();
  updateCalendar();
}
  function getCurrentPhaseClass() {
  const info = getCycleInfo(periods);
  return info.phase;
}
const today = formatDate(new Date());
if (symptoms[today]) {
  showDayModal(today, getCurrentPhaseClass());
}


// --- Historia i kalendarz ---
function updateHistory(){
  const tbody=document.getElementById('historyTable'); tbody.innerHTML='';
  periods.forEach(p=>{
    const len=(parseDate(p.end)-parseDate(p.start))/(1000*60*60*24)+1;
    tbody.innerHTML+=`<tr><td>${p.start}</td><td>${p.end}</td><td>${len}</td></tr>`;
  });
}
let currentCycleIndex = periods.length - 1;

function showPreviousCycle() {
  if (currentCycleIndex > 0) {
    currentCycleIndex--;
    updateCalendar();
  }
}

function showNextCycle() {
  if (currentCycleIndex < periods.length - 1) {
    currentCycleIndex++;
    updateCalendar();
  }
}

function updateCalendar() {
  const calendar = document.getElementById('calendar');
  calendar.innerHTML = '';

  const period = periods[currentCycleIndex];
  const avgCycle = calculateAverageCycle(periods);
  const startDate = parseDate(period.start);

  for (let i = 0; i < avgCycle; i++) {
    const day = new Date(startDate);
    day.setDate(day.getDate() + i);
    let cls = '';
    if (i < 4) cls = 'menstruacja-day';
    else if (i < 12) cls = 'folikularna-day';
    else if (i === 11 || i === 12) cls = 'owulacja-day';
    else cls = 'lutealna-day';
    calendar.innerHTML += `
      <div class='day ${cls}' title='${formatDate(day)}'
           onclick='showDayModal("${formatDate(day)}","${cls}")'>
        ${day.getDate()}
      </div>`;
  }

  // aktualizacja tytułu karty
  document.querySelector(".card h2").textContent =
    "Kalendarz cyklu: " + (currentCycleIndex + 1) + " z " + periods.length;
}


function showDayModal(date, phaseClass) {
  let phase = '';
  if (phaseClass.includes('menstruacja')) phase = 'menstruacja';
  else if (phaseClass.includes('folikularna')) phase = 'folikularna';
  else if (phaseClass.includes('owulacja')) phase = 'owulacja';
  else phase = 'lutealna';

  const modal = document.getElementById('dayModal');
  document.getElementById('modalDate').textContent = date;
  document.getElementById('modalPhase').textContent = 'Faza: ' + phase.toUpperCase();

  // Akordeony
  createAccordion('modalFood', foodData[phase], true);
  createAccordion('modalWellness', wellnessData[phase], true);

  // Objawy dnia
  const symptomsContainer = document.getElementById('modalSymptoms');
  symptomsContainer.innerHTML = ''; // wyczyść poprzednie
  const symptom = symptoms[date];
  if (symptom) {
    symptomsContainer.innerHTML = `
      <div class="symptom-card">
        <h4>Objawy zapisane:</h4>
        <p><strong>Ból:</strong> ${symptom.pain}/10</p>
        <p><strong>Nastrój:</strong> ${symptom.mood}</p>
        <p><strong>Energia:</strong> ${symptom.energy}/10</p>
        <p><strong>Inne:</strong> ${symptom.other || '—'}</p>
      </div>`;
  } else {
    symptomsContainer.innerHTML = `<p>Brak zapisanych objawów.</p>`;
  }

  // Intymność
  const modalIntimacyTips = intimacyData[phase] || [];
  const randomModalIntimacyTip = modalIntimacyTips[Math.floor(Math.random() * modalIntimacyTips.length)] || '';
  document.getElementById('modalIntimacy').innerHTML = `<div class="intimacy-tip">${randomModalIntimacyTip}</div>`;

  modal.style.display = 'flex';
}


document.getElementById('closeModal').addEventListener('click',()=>{document.getElementById('dayModal').style.display='none';});

// --- Dodawanie i LocalStorage ---
function saveHistory(){ localStorage.setItem('cycleHistory',JSON.stringify(periods)); }
function loadHistory(){
  const data=localStorage.getItem('cycleHistory');
  if(data){ try{ const arr=JSON.parse(data); if(Array.isArray(arr)) periods.splice(0,periods.length,...arr); }catch(e){console.error(e);} }
}

function addPeriod(){
  const start=document.getElementById('startDate').value;
  const end=document.getElementById('endDate').value;
  if(start && end){ periods.push({start,end}); saveHistory(); updateUI(); alert('Dodano okres!'); }
  else alert('Wprowadź obie daty.');
}
// --- Objawy dnia ---
let symptoms = JSON.parse(localStorage.getItem('symptoms')) || {};

function saveSymptoms(){
  const date = formatDate(new Date());
  symptoms[date] = {
    pain: document.getElementById('painLevel').value,
    mood: document.getElementById('moodSelect').value,
    energy: document.getElementById('energyLevel').value,
    other: document.getElementById('otherSymptoms').value
  };
  localStorage.setItem('symptoms', JSON.stringify(symptoms));
  alert('Zapisano objawy dnia!');
}

// --- Eksport / Import JSON ---
function exportHistory(){
  const dataStr = JSON.stringify(periods,null,2);
  const blob = new Blob([dataStr],{type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='cycleHistory.json'; a.click();
  URL.revokeObjectURL(url);
}
function importHistory(){
  const file=document.getElementById('importFile').files[0];
  if(!file) return alert('Wybierz plik JSON!');
  const reader=new FileReader();
  reader.onload=e=>{
    try{
      const arr=JSON.parse(e.target.result);
      if(Array.isArray(arr)){ periods.splice(0,periods.length,...arr); saveHistory(); updateUI(); alert('Historia zaimportowana!'); }
      else alert('Niepoprawny format JSON!');
    }catch(err){ alert('Błąd parsowania JSON'); }
  };
  reader.readAsText(file);
}

// --- Service Worker ---
if('serviceWorker' in navigator){ navigator.serviceWorker.register('service-worker.js').then(()=>console.log('SW zarejestrowany')); }

// --- Start ---
loadHistory();
updateUI();
</script>
</body>
</html>
